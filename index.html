<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MyVMK Monthly Prize Tracker</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="container">
    <div class="header-row">
      <div>
        <h1>MyVMK Monthly Prize Tracker</h1>
        <p class="subtle">
          A simple way for you to track your monthly Chests and SITS pulls in MyVMK! All data is stored locally in your browser - if you clear your browser data, you will lose your stats. Make sure to use the export button to download a file you can import later.
        </p>
      </div>

      <div class="header-actions">
        <button id="themeToggle" class="theme-toggle">
          <span id="themeIcon">üåô</span>
          <span id="themeLabel">Dark</span>
        </button>
        <div class="dropdown-menu-wrapper">
          <button id="menuToggle" class="menu-toggle" aria-label="Menu">
            <span class="hamburger-icon">
              <span></span>
              <span></span>
              <span></span>
            </span>
          </button>
          <div id="dropdownMenu" class="dropdown-menu" style="display: none;">
            <button id="cloudSyncBtn" class="dropdown-item">
              <span class="dropdown-icon">‚òÅÔ∏è</span>
              Cloud Sync
            </button>
            <button id="exportBtn" class="dropdown-item">
              <span class="dropdown-icon">üíæ</span>
              Export Data
            </button>
            <label class="dropdown-item">
              <span class="dropdown-icon">üì•</span>
              Import Data
              <input id="importFile" type="file" accept="application/json" hidden />
            </label>
            <div class="dropdown-divider"></div>
            <button id="resetBtn" class="dropdown-item dropdown-item-danger">
              <span class="dropdown-icon">üóëÔ∏è</span>
              Reset Local Data
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="month-tabs" id="monthTabs"></div>

    <div class="system-toggle-bar">
      <div class="system-toggle" id="systemToggle">
        <button type="button" class="system-toggle-btn active" data-system="keys">Chest Keys</button>
        <button type="button" class="system-toggle-btn" data-system="sits">SITS</button>
      </div>
    </div>
  </header>

  <main class="container grid">
    <section class="card span-2" id="quickAddCard">
      <h2>Quick Add</h2>
      <p class="subtle" id="quickAddHint"></p>

      <!-- Bulk Session Mode Toggle -->
      <div id="bulkSessionToggleRow" class="bulk-session-toggle-row">
        <label class="toggle-switch">
          <input type="checkbox" id="bulkSessionToggle" />
          <span class="toggle-slider"></span>
        </label>
        <span class="toggle-label">Bulk Session Mode</span>
        <span class="subtle small">(Log only wins, auto-calculate Ash)</span>
      </div>

      <!-- Bulk Session UI (hidden by default) -->
      <div id="bulkSessionUI" class="bulk-session-ui" style="display: none;">
        <div class="bulk-session-header">
          <div class="field bulk-input-field">
            <label for="bulkTotalKeys">Total Keys (optional)</label>
            <div class="qty-stepper bulk-stepper">
              <button type="button" class="qty-arrow qty-down" id="totalKeysDown" aria-label="Decrease">‚àí</button>
              <input id="bulkTotalKeys" type="number" min="0" placeholder="e.g., 200" />
              <button type="button" class="qty-arrow qty-up" id="totalKeysUp" aria-label="Increase">+</button>
            </div>
          </div>
          <div class="field bulk-input-field">
            <label for="bulkBatchTotal">Batch Total (opens)</label>
            <div class="qty-stepper bulk-stepper">
              <button type="button" class="qty-arrow qty-down" id="batchTotalDown" aria-label="Decrease">‚àí</button>
              <input id="bulkBatchTotal" type="number" min="1" placeholder="e.g., 50" />
              <button type="button" class="qty-arrow qty-up" id="batchTotalUp" aria-label="Increase">+</button>
            </div>
          </div>
          <div class="bulk-session-stats">
            <div class="bulk-stat" id="remainingKeysStat" style="display: none;">
              <span class="bulk-stat-label">Remaining Keys</span>
              <span class="bulk-stat-value" id="bulkRemainingKeys">0</span>
            </div>
            <div class="bulk-stat">
              <span class="bulk-stat-label">Wins Logged</span>
              <span class="bulk-stat-value" id="bulkWinsLogged">0</span>
            </div>
            <div class="bulk-stat">
              <span class="bulk-stat-label">Inferred Ash</span>
              <span class="bulk-stat-value" id="bulkInferredAsh">0</span>
            </div>
          </div>
        </div>

        <div id="bulkWarning" class="bulk-warning" style="display: none;">
          Wins exceed batch total! Ash will be set to 0.
        </div>

        <div class="divider"></div>

        <div id="bulkPrizeList" class="bulk-prize-list"></div>

        <div id="bulkCreditsSection" class="bulk-credits-section">
          <label class="field-label">Credits Wins</label>
          <div class="bulk-credits-grid" id="bulkCreditsGrid"></div>
          <div class="bulk-credits-custom">
            <div class="field">
              <label for="bulkCreditsCustomAmount">Custom Amount</label>
              <input id="bulkCreditsCustomAmount" type="number" min="0" placeholder="e.g., 1000" />
            </div>
            <div class="field">
              <label for="bulkCreditsCustomQty">Qty</label>
              <input id="bulkCreditsCustomQty" type="number" min="1" value="1" style="width: 60px;" />
            </div>
            <button id="bulkCreditsCustomBtn" class="btn btn-secondary">Add</button>
          </div>
        </div>

        <div class="divider"></div>

        <div class="bulk-session-actions">
          <button id="bulkReviewBtn" class="btn">Review & Submit Batch</button>
          <button id="bulkClearBtn" class="btn btn-secondary">Clear Session</button>
        </div>
      </div>

      <!-- Normal Quick Add UI -->
      <div id="normalQuickAddUI">
      <div id="keyColorRow" style="margin-bottom: 14px;">
        <label class="field-label">Key Color</label>
        <div class="key-color-buttons">
          <button type="button" class="key-color-btn bronze active" data-color="bronze">Bronze</button>
          <button type="button" class="key-color-btn silver" data-color="silver">Silver</button>
          <button type="button" class="key-color-btn gold" data-color="gold">Gold</button>
        </div>
      </div>

      <div id="quantityRow" style="margin-bottom: 14px;">
        <label class="field-label">Quantity (for bulk entry)</label>
        <div class="quantity-controls">
          <button type="button" class="btn btn-secondary qty-quick-btn active" data-qty="1">1</button>
          <button type="button" class="btn btn-secondary qty-quick-btn" data-qty="5">5</button>
          <button type="button" class="btn btn-secondary qty-quick-btn" data-qty="10">10</button>
          <button type="button" class="btn btn-secondary qty-quick-btn" data-qty="20">20</button>
          <input id="customQty" type="number" min="1" max="100" value="1" style="width: 70px;" />
        </div>
        <p class="subtle small" id="quantityHint">Clicking a prize button will add 1 entry.</p>
      </div>

      <div id="quickButtons" class="button-grid"></div>

      <div id="ashRow" class="ash-row">
        <button id="addAshBtn" class="btn btn-secondary">Add Ash</button>
        <span class="ash-count-indicator" id="ashCountIndicator">
          <span class="ash-count-value" id="ashCountValue">0</span>
          <span class="ash-count-label">ash this month</span>
        </span>
      </div>

      <div class="divider"></div>

      <div id="creditsRow">
        <div class="credits-header-row">
          <label class="field-label">Add Credits</label>
          <span class="credits-total-indicator" id="creditsTotalIndicator">
            <span class="credits-total-value" id="creditsTotalValue">0</span>
            <span class="credits-total-label">credits this month</span>
          </span>
        </div>
        <div class="credits-quick-row">
          <button type="button" class="btn btn-secondary credit-quick-btn" data-credits="250">+250</button>
          <button type="button" class="btn btn-secondary credit-quick-btn" data-credits="300">+300</button>
          <button type="button" class="btn btn-secondary credit-quick-btn" data-credits="500">+500</button>
          <button type="button" class="btn btn-secondary credit-quick-btn" data-credits="750">+750</button>
          <button type="button" class="btn btn-secondary credit-quick-btn" data-credits="1000">+1000</button>
        </div>
        <div class="credits-manual-row">
          <div class="field">
            <label for="creditsAmount">Custom Amount</label>
            <input id="creditsAmount" type="number" min="0" step="1" placeholder="e.g., 1000" />
          </div>
          <button id="addCreditsBtn" class="btn">Add Credits</button>
        </div>
      </div>

      <div class="small subtle">
        Tip: Your history is stored, and monthly prize updates won't overwrite your past months.
      </div>
      </div><!-- /normalQuickAddUI -->
    </section>

    <section class="card">
      <h2>Chest Keys Summary</h2>
      <div id="summaryKeys" class="summary"></div>
    </section>

    <section class="card">
      <h2>SITS Summary</h2>
      <div id="summarySits" class="summary"></div>
    </section>

    <section class="card span-2 collapsible" id="availablePrizesCard">
      <div class="collapsible-header" id="prizeGalleryHeader">
        <div class="collapsible-title">
          <span class="collapse-icon">‚ñº</span>
          <h2>Available Prizes</h2>
        </div>
        <div class="prize-gallery-toggle">
          <button type="button" class="gallery-toggle-btn active" data-system="sits">SITS</button>
          <button type="button" class="gallery-toggle-btn" data-system="keys">Chests</button>
        </div>
      </div>
      <div class="collapsible-content" id="prizeGalleryContent">
        <div id="prizeGallery" class="prize-gallery"></div>
      </div>
    </section>

    <section class="card span-2" id="eventLogCard">
      <div class="row-between">
        <h2>Event Log (Selected Month)</h2>
        <div class="inline">
          <button id="deleteMonthBtn" class="btn btn-danger btn-small">Delete Selected Month Only</button>
        </div>
      </div>

      <div class="table-wrap">
        <table class="table" id="eventsTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>System</th>
              <th>Key</th>
              <th>Result</th>
              <th>Prize / Credits</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="eventsTbody"></tbody>
        </table>
      </div>
    </section>

    <section class="card span-2">
      <h2>How monthly prize updates work</h2>
      <ol class="subtle">
        <li>bsims updates <code>prizeConfig.js</code> each month with the updated month‚Äôs prizes.</li>
        <li>When you reload the page, you will see a new month section with updated prize buttons.</li>
        <li>Historical entries stay consistent.</li>
      </ol>
    </section>
  </main>

  <footer class="container footer subtle">
    <div>
      No accounts. No storage. Export your data to avoid losing it.
    </div>
  </footer>

  <!-- Bulk Session Confirmation Modal -->
  <div id="bulkConfirmModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <h3>Review Batch Session</h3>
      <div id="bulkConfirmSummary" class="bulk-confirm-summary"></div>
      <div class="modal-actions">
        <button id="bulkConfirmSubmit" class="btn">Confirm & Add to Stats</button>
        <button id="bulkConfirmCancel" class="btn btn-secondary">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Cloud Sync Modal -->
  <div id="cloudSyncModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <h3>Cloud Sync via GitHub Gist</h3>
      <div class="cloud-sync-content">
        <p class="subtle">Sync your data across devices using GitHub Gists. Your data remains private and secure.</p>

        <div id="cloudSyncStatus" class="cloud-sync-status"></div>

        <div id="cloudSyncSetup" class="cloud-sync-setup">
          <h4>Setup Instructions</h4>
          <ol class="subtle small">
            <li>Go to <a href="https://github.com/settings/tokens/new" target="_blank">GitHub Tokens</a> and create a new token</li>
            <li>Give it a name like "MyVMK Prize Tracker"</li>
            <li>Set expiration (or choose "No expiration" for convenience)</li>
            <li>Under "Select scopes", check <strong>gist</strong></li>
            <li>Click "Generate token" and copy it</li>
            <li>Paste your token below</li>
          </ol>

          <div class="field">
            <label for="githubToken">GitHub Personal Access Token</label>
            <input id="githubToken" type="password" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" />
          </div>

          <div class="field">
            <label for="gistId">Gist ID (leave empty to create new)</label>
            <input id="gistId" type="text" placeholder="Optional: existing gist ID" />
            <p class="subtle small">If you already have a gist for this tracker, paste its ID here. Otherwise, leave empty and a new private gist will be created on first sync.</p>
          </div>
        </div>

        <div id="cloudSyncActions" class="cloud-sync-actions">
          <button id="saveCloudSyncSettings" class="btn">Save Settings</button>
          <button id="syncNow" class="btn btn-secondary" disabled>Sync Now</button>
          <button id="clearCloudSyncSettings" class="btn btn-danger btn-small">Clear Settings</button>
        </div>

        <div id="cloudSyncHelp" class="cloud-sync-help subtle small">
          <strong>How it works:</strong>
          <ul>
            <li><strong>Sync Now</strong> uploads your current data and downloads any changes from GitHub</li>
            <li>Data is automatically merged - events from both sources are combined</li>
            <li>Your data is stored as a private Gist on your GitHub account</li>
            <li>Local storage remains the primary source - cloud is just for backup/sync</li>
          </ul>
        </div>
      </div>
      <div class="modal-actions">
        <button id="closeCloudSyncModal" class="btn btn-secondary">Close</button>
      </div>
    </div>
  </div>

  <script src="./prizeConfig.js"></script>
  <script src="./app.js"></script>
</body>
</html>
