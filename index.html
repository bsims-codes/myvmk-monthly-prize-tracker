<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MyVMK Monthly Prize Tracker</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="container">
    <div class="header-row">
      <div>
        <h1>MyVMK Monthly Prize Tracker</h1>
        <p class="subtle">
          Local tracker for monthly Keys + SITS. All data is stored in your browser - if you clear your browser data, you will lose your data.
        </p>
      </div>

      <div class="header-actions">
        <button id="themeToggle" class="theme-toggle">
          <span id="themeIcon">ðŸŒ™</span>
          <span id="themeLabel">Dark</span>
        </button>
        <button id="exportBtn" class="btn">Export</button>
        <label class="btn btn-secondary">
          Import
          <input id="importFile" type="file" accept="application/json" hidden />
        </label>
        <button id="resetBtn" class="btn btn-danger">Reset Local Data</button>
      </div>
    </div>

    <div class="month-tabs" id="monthTabs"></div>

    <div class="bar bar-2col">
      <div class="field">
        <label for="systemSelect">Chests/SITS</label>
        <select id="systemSelect">
          <option value="keys">Chest Keys</option>
          <option value="sits">SITS</option>
        </select>
      </div>

      <div class="field">
        <label for="dateInput">Date</label>
        <input id="dateInput" type="date" />
      </div>
    </div>
  </header>

  <main class="container grid">
    <section class="card span-2" id="quickAddCard">
      <h2>Quick Add</h2>
      <p class="subtle" id="quickAddHint"></p>

      <!-- Bulk Session Mode Toggle -->
      <div id="bulkSessionToggleRow" class="bulk-session-toggle-row">
        <label class="toggle-switch">
          <input type="checkbox" id="bulkSessionToggle" />
          <span class="toggle-slider"></span>
        </label>
        <span class="toggle-label">Bulk Session Mode</span>
        <span class="subtle small">(Log only wins, auto-calculate Ash)</span>
      </div>

      <!-- Bulk Session UI (hidden by default) -->
      <div id="bulkSessionUI" class="bulk-session-ui" style="display: none;">
        <div class="bulk-session-header">
          <div class="field">
            <label for="bulkBatchTotal">Batch Total (opens)</label>
            <input id="bulkBatchTotal" type="number" min="1" placeholder="e.g., 50" />
          </div>
          <div class="bulk-session-stats">
            <div class="bulk-stat">
              <span class="bulk-stat-label">Wins Logged</span>
              <span class="bulk-stat-value" id="bulkWinsLogged">0</span>
            </div>
            <div class="bulk-stat">
              <span class="bulk-stat-label">Inferred Ash</span>
              <span class="bulk-stat-value" id="bulkInferredAsh">0</span>
            </div>
          </div>
        </div>

        <div id="bulkWarning" class="bulk-warning" style="display: none;">
          Wins exceed batch total! Ash will be set to 0.
        </div>

        <div class="divider"></div>

        <div id="bulkPrizeList" class="bulk-prize-list"></div>

        <div id="bulkCreditsSection" class="bulk-credits-section">
          <label class="field-label">Credits Wins</label>
          <div class="bulk-credits-grid" id="bulkCreditsGrid"></div>
          <div class="bulk-credits-custom">
            <div class="field">
              <label for="bulkCreditsCustomAmount">Custom Amount</label>
              <input id="bulkCreditsCustomAmount" type="number" min="0" placeholder="e.g., 1000" />
            </div>
            <div class="field">
              <label for="bulkCreditsCustomQty">Qty</label>
              <input id="bulkCreditsCustomQty" type="number" min="1" value="1" style="width: 60px;" />
            </div>
            <button id="bulkCreditsCustomBtn" class="btn btn-secondary">Add</button>
          </div>
        </div>

        <div class="divider"></div>

        <div class="bulk-session-actions">
          <button id="bulkReviewBtn" class="btn">Review & Submit Batch</button>
          <button id="bulkClearBtn" class="btn btn-secondary">Clear Session</button>
        </div>
      </div>

      <!-- Normal Quick Add UI -->
      <div id="normalQuickAddUI">
      <div id="keyColorRow" style="margin-bottom: 14px;">
        <label class="field-label">Key Color</label>
        <div class="key-color-buttons">
          <button type="button" class="key-color-btn bronze active" data-color="bronze">Bronze</button>
          <button type="button" class="key-color-btn silver" data-color="silver">Silver</button>
          <button type="button" class="key-color-btn gold" data-color="gold">Gold</button>
        </div>
      </div>

      <div id="quantityRow" style="margin-bottom: 14px;">
        <label class="field-label">Quantity (for bulk entry)</label>
        <div class="quantity-controls">
          <button type="button" class="btn btn-secondary qty-quick-btn active" data-qty="1">1</button>
          <button type="button" class="btn btn-secondary qty-quick-btn" data-qty="5">5</button>
          <button type="button" class="btn btn-secondary qty-quick-btn" data-qty="10">10</button>
          <button type="button" class="btn btn-secondary qty-quick-btn" data-qty="20">20</button>
          <input id="customQty" type="number" min="1" max="100" value="1" style="width: 70px;" />
        </div>
        <p class="subtle small" id="quantityHint">Clicking a prize button will add 1 entry.</p>
      </div>

      <div id="quickButtons" class="button-grid"></div>

      <div class="divider"></div>

      <div id="creditsRow">
        <label class="field-label">Add Credits</label>
        <div class="credits-quick-row">
          <button type="button" class="btn btn-secondary credit-quick-btn" data-credits="250">+250</button>
          <button type="button" class="btn btn-secondary credit-quick-btn" data-credits="300">+300</button>
          <button type="button" class="btn btn-secondary credit-quick-btn" data-credits="500">+500</button>
          <button type="button" class="btn btn-secondary credit-quick-btn" data-credits="750">+750</button>
        </div>
        <div class="credits-manual-row">
          <div class="field">
            <label for="creditsAmount">Custom Amount</label>
            <input id="creditsAmount" type="number" min="0" step="1" placeholder="e.g., 1000" />
          </div>
          <button id="addCreditsBtn" class="btn">Add Credits</button>
        </div>
      </div>

      <div class="ash-row">
        <button id="addAshBtn" class="btn btn-secondary">Add Ash</button>
      </div>

      <div class="small subtle">
        Tip: Your history is stored, and monthly prize updates won't overwrite your past months.
      </div>
      </div><!-- /normalQuickAddUI -->
    </section>

    <section class="card">
      <h2>Chest Keys Summary</h2>
      <div id="summaryKeys" class="summary"></div>
    </section>

    <section class="card">
      <h2>SITS Summary</h2>
      <div id="summarySits" class="summary"></div>
    </section>

    <section class="card span-2 collapsible" id="availablePrizesCard">
      <div class="collapsible-header" id="prizeGalleryHeader">
        <div class="collapsible-title">
          <span class="collapse-icon">â–¼</span>
          <h2>Available Prizes</h2>
        </div>
        <div class="prize-gallery-toggle">
          <button type="button" class="gallery-toggle-btn active" data-system="sits">SITS</button>
          <button type="button" class="gallery-toggle-btn" data-system="keys">Chests</button>
        </div>
      </div>
      <div class="collapsible-content" id="prizeGalleryContent">
        <div id="prizeGallery" class="prize-gallery"></div>
      </div>
    </section>

    <section class="card span-2" id="eventLogCard">
      <div class="row-between">
        <h2>Event Log (Selected Month)</h2>
        <div class="inline">
          <button id="deleteMonthBtn" class="btn btn-danger btn-small">Delete Selected Month Only</button>
        </div>
      </div>

      <div class="table-wrap">
        <table class="table" id="eventsTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>System</th>
              <th>Key</th>
              <th>Result</th>
              <th>Prize / Credits</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="eventsTbody"></tbody>
        </table>
      </div>
    </section>

    <section class="card span-2">
      <h2>How monthly prize updates work</h2>
      <ol class="subtle">
        <li>bsims updates <code>prizeConfig.js</code> each month with the updated monthâ€™s prizes.</li>
        <li>When you reload the page, you will see a new month section with updated prize buttons.</li>
        <li>Historical entries stay consistent.</li>
      </ol>
    </section>
  </main>

  <footer class="container footer subtle">
    <div>
      No accounts. No storage. Export your data to avoid losing it.
    </div>
  </footer>

  <!-- Bulk Session Confirmation Modal -->
  <div id="bulkConfirmModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <h3>Review Batch Session</h3>
      <div id="bulkConfirmSummary" class="bulk-confirm-summary"></div>
      <div class="modal-actions">
        <button id="bulkConfirmSubmit" class="btn">Confirm & Add to Stats</button>
        <button id="bulkConfirmCancel" class="btn btn-secondary">Cancel</button>
      </div>
    </div>
  </div>

  <script src="./prizeConfig.js"></script>
  <script src="./app.js"></script>
</body>
</html>
